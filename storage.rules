rules_version = '2';

// CP: Firebase Storage security rules for user images
// Users can only access their own images at users/{uid}/images/*
service firebase.storage {
  match /b/{bucket}/o {
    // CP: Allow users to read/write only their own images
    match /users/{userId}/images/{imageId} {
      // User must be authenticated
      allow read, write: if request.auth != null
        // User can only access their own folder
        && request.auth.uid == userId
        // Only allow image files with size limit (10MB max)
        && (request.resource == null
            || (request.resource.contentType.matches('image/.*')
                && request.resource.size < 10 * 1024 * 1024));
    }

    // CP: Deny access to all other paths
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
