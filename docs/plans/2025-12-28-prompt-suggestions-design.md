# Prompt Suggestions for Chat

## Overview

Add AI-generated prompt suggestions above the dashboard input bar to help users discover what they can ask about their logged entries. Prompts are personalized based on recent entry patterns.

## User Experience

- 2-3 tappable chips displayed in a horizontal row above the floating input bar
- Tapping a chip navigates to the chat page with that query pre-filled
- Prompts are fully dynamic, generated by AI based on recent entries
- Section is hidden when there's insufficient data (<5 entries) or no prompts available

## Data Flow

```
Entry Added
    ↓
DashboardV2Cubit.handleUserInput() completes
    ↓
Debounce 2 seconds (in case of rapid logging)
    ↓
AiService.generatePromptSuggestions(recentEntries, currentDate)
    ↓
AI returns 2-3 personalized prompt strings
    ↓
Stored in DashboardV2State.promptSuggestions
    ↓
Persisted to SharedPreferences
    ↓
PromptSuggestionsRow displays chips
```

## AI Service Method

### Signature

```dart
Future<List<String>> generatePromptSuggestions({
  required List<Entry> recentEntries,
  required DateTime currentDate,
})
```

### Input

- Last 10-20 entries (text, category, timestamp, isTask, isCompleted)
- Current date for temporal awareness

### Output

- List of 2-3 short prompt strings
- Empty list if generation fails or insufficient context

### System Prompt

```
You generate 2-3 short chat prompts for a personal logging app.
Based on the user's recent entries, suggest questions they might
want to ask about their logged data.

Guidelines:
- Keep prompts under 8 words
- Reference specific patterns you see (categories, tasks, time periods)
- Vary the prompt types: reflection, summary, actionable
- Use "I" perspective ("What did I...", "How's my...")

Return JSON: { "prompts": ["...", "..."] }
```

### Model

- GPT-5-mini (`gpt5Mini` constant)

### Minimum Threshold

- Only call AI if user has 5+ entries
- Below that, return empty list (section hidden)

## UI Component

### Widget: PromptSuggestionsRow

**Location:** Positioned above `FloatingInputBar` in the dashboard Stack

**Visual Design:**
- Horizontal `ListView` of tappable chips
- Chip style: outlined/subtle background, rounded corners
- Optional icon prefix (sparkle or chat bubble)
- Gentle fade-in animation when prompts load
- Horizontally scrollable (prompts likely overflow on mobile)

**Spacing:**
- ~8px gap between chips
- Row sits ~8px above the input bar
- Left padding aligns with input bar

**Behavior:**
- Tap chip → Navigate to `ReimaginedChatPage` with `ChatCubit.startChatWithQuery(prompt)`
- Hidden when `promptSuggestions` is empty

## Regeneration Logic

### Trigger

- Only when a new entry is added (not on edit/delete)
- Called after `handleUserInput` or `handleImageInput` succeeds

### Debouncing

- 2-second debounce timer
- Prevents excessive API calls during rapid logging (voice input, bulk)

### Loading State

- No loading indicator (too subtle to warrant visual noise)
- Old prompts remain visible until new ones arrive, then swap

## State Management

### DashboardV2State

```dart
class DashboardV2State extends Equatable {
  // ... existing fields
  final List<String> promptSuggestions;

  // copyWith, props, etc.
}
```

### Persistence

- Stored in SharedPreferences as JSON array
- Loaded on app start, regenerated when entries change
- Key: `prompt_suggestions`

## Files to Modify

| File | Changes |
|------|---------|
| `lib/services/ai_service.dart` | Add `generatePromptSuggestions()` method |
| `lib/dashboard_v2/cubit/dashboard_v2_state.dart` | Add `promptSuggestions` field |
| `lib/dashboard_v2/cubit/dashboard_v2_cubit.dart` | Add regeneration logic, load/persist prompts |
| `lib/dashboard_v2/pages/dashboard_v2_page.dart` | Add `PromptSuggestionsRow` to Stack |

## New Files

| File | Purpose |
|------|---------|
| `lib/dashboard_v2/widgets/prompt_suggestions_row.dart` | Horizontal chip row widget |

## Edge Cases

| Scenario | Behavior |
|----------|----------|
| <5 entries | Section hidden, no AI call |
| AI call fails | Section hidden, old prompts cleared |
| App cold start | Load cached prompts from SharedPreferences |
| No cached prompts | Section hidden until first regeneration |
| Rapid entry additions | Debounce prevents multiple AI calls |
